<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="shortcut icon" href="../img/logo.png" type="image/x-icon">
    
    <style>
        :root {
            --hue: 210;
            --primary-color: hsl(var(--hue), 85%, 55%);
            --bg-light: #f4f6f9;
            --bg-dark: #191c29;
            --card-light: rgba(255, 255, 255, 0.75);
            --card-dark: rgba(40, 45, 70, 0.6);
            --text-light: #f0f0f0;
            --text-dark: #121212;
            --shadow-light: rgba(31, 38, 135, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.2);
            --border-light: rgba(255, 255, 255, 0.3);
            --border-dark: rgba(255, 255, 255, 0.1);
            --accordion-btn-light: #ffffff;
            --accordion-btn-dark: #1f233d;
            
            --bg-color: var(--bg-light);
            --card-bg-color: var(--card-light);
            --text-color: var(--text-dark);
            --shadow-color: var(--shadow-light);
            --border-color: var(--border-light);
            --accordion-btn-color: var(--accordion-btn-light);
        }
        body.dark-mode {
            --bg-color: var(--bg-dark);
            --card-bg-color: var(--card-dark);
            --text-color: var(--text-light);
            --shadow-color: var(--shadow-dark);
            --border-color: var(--border-dark);
            --accordion-btn-color: var(--accordion-btn-dark);
        }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s ease, color 0.5s ease;
            padding-top: 2rem;
            padding-bottom: 2rem;
            min-height: 100vh;
        }
        .main-container {
            max-width: 900px;
            background: var(--card-bg-color);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 12px 32px 0 var(--shadow-color);
            padding: 2.5rem;
            transition: background-color 0.5s ease, border 0.5s ease;
        }
        .main-header { color: var(--primary-color); text-shadow: 1px 1px 2px var(--shadow-color); }
        .theme-switch-wrapper { display: flex; align-items: center; position: absolute; top: 1.5rem; right: 1.5rem; z-index: 1000; }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 50px; margin: 0 10px; }
        .theme-switch input { display: none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
        .slider:before { background-color: #fff; bottom: 3px; content: ""; height: 18px; left: 3px; position: absolute; transition: .4s; width: 18px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }
        .form-control, .input-group-text { background-color: var(--card-bg-color) !important; color: var(--text-color) !important; border-color: var(--border-color) !important; }
        .form-control::placeholder { color: var(--text-color) !important; opacity: 0.6; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 4px 12px var(--shadow-color); }
        .table { --bs-table-bg: transparent; --bs-table-hover-bg: rgba(120, 120, 120, 0.1); --bs-table-color: var(--text-color); border-radius: 0.75rem; overflow: hidden; }
        .table > :not(caption) > * > * { border-bottom-width: 0; }
        .table > thead { border-bottom: 1px solid var(--border-color); }
        .accordion-item { background-color: transparent; border: 1px solid var(--border-color); border-radius: 0.75rem !important; }
        .accordion-button { background-color: var(--accordion-btn-color); color: var(--text-color); transition: background-color 0.5s ease, color 0.5s ease; }
        .accordion-button:not(.collapsed) { background-color: var(--primary-color); color: white; }
        .accordion-button:focus { box-shadow: 0 0 0 0.25rem hsla(var(--hue), 85%, 55%, 0.25); }
        .accordion-body { background-color: var(--accordion-btn-color); transition: background-color 0.5s ease; }
        .list-group-item { background-color: transparent; border-color: var(--border-color); }
    </style>
</head>
<body>

    <div class="theme-switch-wrapper">
        <i class="bi bi-sun-fill"></i>
        <label class="theme-switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
        <i class="bi bi-moon-stars-fill"></i>
    </div>

    <div class="container main-container" data-aos="fade-up">
        <header class="text-center mb-5">
            <h1 class="display-5 fw-bold main-header">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ IT</h1>
        </header>
        <main>
            <section class="mb-5" data-aos="fade-up" data-aos-delay="100">
                <div class="card border-0 shadow-sm h-100" style="background-color: transparent;">
                    <div class="card-body p-lg-4">
                        <div class="input-group mb-4"><span class="input-group-text fw-bold border-0"><i class="bi bi-calendar-event me-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span><input type="date" id="date-selector" class="form-control border-0"></div>
                        <form id="attendance-form">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead><tr><th scope="col">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)</th><th scope="col" class="text-center" style="width: 100px;"><div class="form-check form-check-inline"><input class="form-check-input fs-5" type="checkbox" id="select-all-checkbox" title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"><label class="form-check-label" for="select-all-checkbox">‡∏°‡∏≤</label></div></th></tr></thead>
                                    <tbody id="student-table-body"></tbody>
                                </table>
                            </div>
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3"><button type="button" id="edit-btn" class="btn btn-outline-secondary px-4"><i class="bi bi-pencil me-2"></i>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button type="submit" id="save-btn" class="btn btn-success px-4"><i class="bi bi-check-circle me-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                        </form>
                    </div>
                </div>
            </section>
            <section data-aos="fade-up" data-aos-delay="200">
                <div class="d-flex justify-content-between align-items-center mb-3"><h2 class="h4 mb-0 fw-bold">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h2><button id="clear-history-btn" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash3 me-1"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></div>
                <div class="accordion" id="history-container"></div>
                <div class="d-grid mt-4"><button id="export-btn" class="btn btn-primary"><i class="bi bi-download me-2"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (CSV)</button></div>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        const studentList=["‡∏ô‡∏≤‡∏¢‡∏û‡∏£‡∏´‡∏°‡∏û‡∏¥‡∏£‡∏¥‡∏¢‡∏∞ ‡πÅ‡∏™‡∏á‡∏û‡∏ä‡∏£ (‡πÄ‡∏ï‡∏¥‡πâ‡∏•)","‡∏ô‡∏≤‡∏¢‡∏†‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£ ‡∏°‡∏µ‡πÇ‡∏û‡∏ò‡∏¥‡πå‡∏™‡∏° (‡∏õ‡∏•‡∏≤‡∏¢)","‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏¢‡πå ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ô‡∏≤‡∏° (‡πÅ‡∏°‡πá‡∏Ñ)","‡∏ô‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏®‡∏£‡∏µ‡∏õ‡∏£‡∏∞‡∏†‡∏≤ (‡πÅ‡∏ü‡∏£‡∏á‡∏Ñ‡πå)","‡∏ô‡∏≤‡∏¢‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏Ñ‡∏á‡πÑ‡∏ó‡∏¢ (BM)","‡∏ô‡∏≤‡∏¢‡∏û‡∏ô‡∏ò‡∏Å‡∏£ ‡∏†‡∏π‡∏ö‡∏≤‡∏•‡∏µ (‡∏´‡∏°‡∏≠‡∏Å)","‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏Å‡∏£ ‡∏°‡∏±‡πà‡∏á‡∏™‡∏π‡∏á‡πÄ‡∏ô‡∏¥‡∏ô (‡∏Å‡∏£)","‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏Å‡∏≤‡∏ô‡∏ï‡πå ‡∏ö‡∏±‡∏ß‡∏ó‡∏∏‡∏° (‡πÇ‡∏≠‡πâ)","‡∏ô‡∏≤‡∏¢‡∏™‡∏¥‡∏£‡πÄ‡∏¢‡∏™ ‡∏™‡∏ô‡πÄ‡∏Ñ‡∏´‡∏á‡∏©‡πå (‡πÄ‡∏¢‡∏™)","‡∏ô‡∏≤‡∏¢‡∏ô‡∏§‡πÄ‡∏ö‡∏® ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡πÄ‡∏ö‡∏™)","‡∏ô‡∏≤‡∏¢‡∏®‡∏±‡∏Å‡∏†‡∏≤‡∏ß‡∏∏‡∏í ‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏≤‡∏•‡∏±‡∏¢ (‡∏¢‡∏±‡∏°)","‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏Å‡∏£ ‡∏£‡∏±‡∏Å‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå (‡∏Ñ‡∏¥‡∏á)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏é‡∏ê‡∏Å‡∏°‡∏• ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ó‡∏≤ (‡∏ô‡πâ‡∏≥‡πÄ‡∏´‡∏ô‡∏∑‡∏≠)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå ‡∏ú‡∏¥‡∏ô‡∏™‡∏±‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏∞ (‡∏°‡∏∞‡∏•‡∏¥)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏¥‡∏°‡∏û‡∏Å‡∏≤‡∏ô‡∏ï‡πå ‡∏ß‡∏á‡∏©‡πå‡∏à‡∏¥‡∏ô‡∏î‡∏≤ (‡πÄ‡∏î‡∏µ‡∏¢‡∏£‡πå)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏†‡∏¥‡∏ä‡∏ç‡∏≤ ‡∏£‡∏±‡∏°‡∏°‡∏∞‡πÑ‡∏° (‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏¥‡∏ï‡∏£‡∏ß‡∏î‡∏µ ‡∏Ñ‡∏á‡∏Ç‡∏≤‡∏ß (‡∏´‡∏ô‡∏≤‡∏°‡πÄ‡∏ï‡∏¢)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏•‡∏¥‡∏ô‡∏î‡∏≤ ‡πÄ‡∏ä‡∏µ‡∏¢‡∏£ (‡∏•‡∏¥‡∏ô‡∏î‡∏≤)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏±‡∏ê ‡∏Å‡∏•‡∏°‡∏ß‡∏á (‡πÑ‡∏≠‡∏ß‡∏µ‡πà)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤ ‡∏à‡πâ‡∏≠‡∏¢‡∏ö‡∏≥‡∏£‡∏∏‡∏á (‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå)","‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ï‡∏£‡∏µ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏ô‡∏¥‡∏†‡∏≤ ‡∏™‡∏∏‡∏Ç‡∏™‡∏°‡∏û‡∏•‡∏≠‡∏¢ (‡∏´‡∏ç‡∏¥‡∏á)"];
        const STORAGE_KEY='attendanceSystemHistory_v2';
        const THEME_KEY='attendanceTheme';
        const dateSelector=document.getElementById('date-selector');
        const tableBody=document.getElementById('student-table-body');
        const editBtn=document.getElementById('edit-btn');
        const saveBtn=document.getElementById('save-btn');
        const selectAllCheckbox=document.getElementById('select-all-checkbox');
        const historyContainer=document.getElementById('history-container');
        const clearHistoryBtn=document.getElementById('clear-history-btn');
        const exportBtn=document.getElementById('export-btn');
        const themeToggle=document.getElementById('theme-toggle');

        const getHistory=()=>JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
        const saveHistory=(history)=>localStorage.setItem(STORAGE_KEY,JSON.stringify(history));

        const renderStudentList=()=>{tableBody.innerHTML=studentList.map(s=>`<tr><td>${s}</td><td class="text-center"><div class="form-check form-check-inline"><input class="form-check-input fs-5" type="checkbox" data-student="${s}" disabled></div></td></tr>`).join('')};
        const renderHistory=()=>{const history=getHistory(),sortedDates=Object.keys(history).sort((a,b)=>new Date(b)-new Date(a));if(sortedDates.length===0){historyContainer.innerHTML='<div class="text-center p-3 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';return}
        historyContainer.innerHTML=sortedDates.map(date=>{const present=history[date]||[],count=present.length,id=date.replace(/-/g,'');return`<div class="accordion-item"><h2 class="accordion-header"><div class="d-flex w-100 align-items-center"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c-${id}"><strong class="me-3">${date}</strong> <span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill">‡∏°‡∏≤ ${count} ‡∏Ñ‡∏ô</span></button><button class="btn btn-sm text-danger delete-btn me-2" data-date="${date}" title="‡∏•‡∏ö"><i class="bi bi-trash3-fill fs-5"></i></button></div></h2><div id="c-${id}" class="accordion-collapse collapse" data-bs-parent="#history-container"><div class="accordion-body pt-0">${count>0?'<ol class="list-group list-group-flush">'+present.map(s=>`<li class="list-group-item">${s}</li>`).join('')+'</ol>':'<p class="mb-0 text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ã‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>'}</div></div></div>`}).join('')};
        const setMode=(mode)=>{const isEdit=mode==='edit';document.querySelectorAll('#student-table-body input[type="checkbox"]').forEach(cb=>cb.disabled=!isEdit);selectAllCheckbox.disabled=!isEdit;editBtn.style.display=isEdit?'none':'block';saveBtn.style.display=isEdit?'block':'none'};
        const loadDataForDate=(date)=>{const history=getHistory(),present=history[date]||[],allCb=document.querySelectorAll('#student-table-body input');allCb.forEach(cb=>{cb.checked=present.includes(cb.dataset.student)});selectAllCheckbox.checked=allCb.length>0&&[...allCb].every(cb=>cb.checked);setMode(history[date]?'view':'edit')};
        const handleDateChange=()=>{if(dateSelector.value)loadDataForDate(dateSelector.value)};
        const handleSave=(e)=>{e.preventDefault();if(!dateSelector.value){Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å','error');return}const present=Array.from(document.querySelectorAll('#student-table-body input:checked')).map(cb=>cb.dataset.student);const history=getHistory();history[dateSelector.value]=present;saveHistory(history);Swal.fire({title:'‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',text:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',icon:'success',timer:1500,showConfirmButton:false});loadDataForDate(dateSelector.value);renderHistory()};
        const handleClearAll=()=>{if(Object.keys(getHistory()).length===0){Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏•‡∏ö','info');return}
        Swal.fire({title:'‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',text:"‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!",icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',cancelButtonColor:'#6c757d',confirmButtonText:'‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î!',cancelButtonText:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'}).then(r=>{if(r.isConfirmed){localStorage.removeItem(STORAGE_KEY);renderHistory();handleDateChange();Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß!','‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢','success')}})};
        const handleDeleteSingle=(e)=>{const btn=e.target.closest('.delete-btn');if(!btn)return;const date=btn.dataset.date;Swal.fire({title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',text:`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date}?`,icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',cancelButtonColor:'#6c757d',confirmButtonText:'‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢',cancelButtonText:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'}).then(r=>{if(r.isConfirmed){const history=getHistory();delete history[date];saveHistory(history);renderHistory();handleDateChange()}})};
        const handleExport=()=>{const history=getHistory();if(Object.keys(history).length===0){Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å','info');return}
        let csv="data:text/csv;charset=utf-8,\uFEFF";csv+="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,"+studentList.join(",")+"\r\n";Object.keys(history).sort().forEach(date=>{const present=new Set(history[date]);const row=studentList.map(s=>present.has(s)?'‚úì':'').join(",");csv+=date+","+row+"\r\n"});const link=document.createElement("a");link.setAttribute("href",encodeURI(csv));link.setAttribute("download",`attendance_export_${new Date().toISOString().slice(0,10)}.csv`);document.body.appendChild(link);link.click();document.body.removeChild(link)};
        const applyTheme=(theme)=>{if(theme==='dark'){document.body.classList.add('dark-mode');themeToggle.checked=true}else{document.body.classList.remove('dark-mode');themeToggle.checked=false}};themeToggle.addEventListener('change',()=>{const newTheme=themeToggle.checked?'dark':'light';localStorage.setItem(THEME_KEY,newTheme);applyTheme(newTheme)});
        
        document.addEventListener('DOMContentLoaded',()=>{
            AOS.init({duration:600,once:true,});
            const savedTheme=localStorage.getItem(THEME_KEY)||'light';
            applyTheme(savedTheme);
            dateSelector.value=new Date().toISOString().slice(0,10);
            renderStudentList();
            handleDateChange();
            renderHistory();
            dateSelector.addEventListener('change',handleDateChange);
            document.querySelector('#attendance-form').addEventListener('submit',handleSave);
            editBtn.addEventListener('click',()=>setMode('edit'));
            selectAllCheckbox.addEventListener('change',(e)=>{document.querySelectorAll('#student-table-body input[type="checkbox"]:not(:disabled)').forEach(cb=>cb.checked=e.target.checked)});
            clearHistoryBtn.addEventListener('click',handleClearAll);
            historyContainer.addEventListener('click',handleDeleteSingle);
            exportBtn.addEventListener('click',handleExport);
        });
    </script>
</body>
</html>
